{% extends "base.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/goals.css' %}">
{% block title %}Goals - MnE System{% endblock %}

{% block content %}
<div class="goals-container">
  <h2>ðŸ“Œ Goals</h2>

  <!-- Add Goal Form -->
  <div class="goal-form">
    <h3>Add New Goal</h3>
    <form id="goalForm">
      {% csrf_token %}
      <input type="text" name="title" placeholder="Goal Title" required />
      <textarea name="description" placeholder="Goal Description" required></textarea>
      <button type="submit">Add Goal</button>
    </form>
  </div>

  <!-- Goal Table -->
  <div class="goal-table">
    <h3>Existing Goals</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Description</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody id="goalTableBody">
        <!-- Goals will be populated here via JS -->
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("goalForm");
  const tableBody = document.getElementById("goalTableBody");

  // Fetch existing goals
  fetch("/api/v1/logframe/api/goals/")
    .then(res => res.json())
    .then(data => {
      data.forEach(goal => {
        const row = `
          <tr>
            <td>${goal.id}</td>
            <td>${goal.title}</td>
            <td>${goal.description}</td>
            <td>${new Date(goal.created_at).toLocaleString()}</td>
          </tr>`;
        tableBody.innerHTML += row;
      });
    });

  // Handle form submission
  form.addEventListener("submit", function (e) {
    e.preventDefault();
    const formData = new FormData(form);
    fetch("/api/v1/logframe/api/goals/", {
      method: "POST",
      headers: {
        "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        title: formData.get("title"),
        description: formData.get("description")
      })
    })
    .then(res => res.json())
    .then(newGoal => {
      const row = `
        <tr>
          <td>${newGoal.id}</td>
          <td>${newGoal.title}</td>
          <td>${newGoal.description}</td>
          <td>${new Date(newGoal.created_at).toLocaleString()}</td>
        </tr>`;
      tableBody.innerHTML += row;
      form.reset();
    });
  });
});
</script>
{% endblock %}
