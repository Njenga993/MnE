{% extends 'base.html' %}
{% load static %}
{% block title %}Outputs - MnE System{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/outputs.css' %}">

<div class="output-container">
  <h2>Outputs</h2>

    <!-- Add Output Form -->
     <div class="output-form">
<form method="POST" id="output-form">
  {% csrf_token %}
  
  <label for="title">Title:</label>
  <input type="text" name="title" required>

  <label for="description">Description:</label>
  <textarea name="description" rows="4" required></textarea>

  <label for="outcome">Select Outcome:</label>
  <select name="outcome" required>
    <option value="">-- Choose Outcome --</option>
    {% for outcome in outcomes %}
      <option value="{{ outcome.id }}">{{ outcome.title }}</option>
    {% endfor %}
  </select>

  <button type="submit">Add Output</button>
</form>
</div>

  <!-- Outputs Table -->
   <div class="output-table">
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Outcome</th>
      </tr>
    </thead>
    <tbody>
      {% for output in outputs %}
        <tr>
          <td>{{ output.title }}</td>
          <td>{{ output.description }}</td>
          <td>{{ output.outcome.title }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
  <hr>


</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.querySelector("form");
  form.addEventListener("submit", function(event) {
    event.preventDefault();
    const formData = new FormData(form);

    fetch("/api/v1/logframe/api/outputs/", {
      method: "POST",
      body: formData,
      headers: {
        'X-CSRFToken': '{{ csrf_token }}'
      }
    })
    .then(response => response.json())
    .then(data => {
      location.reload();
    })
    .catch(error => {
      console.error("Error:", error);
      alert("An error occurred while adding the output.");
    });
  });
});
</script>
{% endblock %}
