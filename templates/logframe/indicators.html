{% extends 'base.html' %}
{% load static %}
{% block title %}Indicators - MnE System{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/indicators.css' %}">

<div class="indicator-container">
  <h2>Indicators</h2>

    <!-- Add New Indicator -->
     <div class="indicator-form">
  <h3>Add New Indicator</h3>
  <form id="indicator-form" method="POST">
    {% csrf_token %}

    <label>Name:</label>
    <input type="text" name="name" required>

    <label>Means of Verification:</label>
    <input type="text" name="means_of_verification" required>

    <label>Unit of Measurement:</label>
    <input type="text" name="unit_of_measurement" required>

    <label>Baseline:</label>
    <input type="number" step="0.01" name="baseline" required>

    <label>Target:</label>
    <input type="number" step="0.01" name="target" required>

    <label>Actual:</label>
    <input type="number" step="0.01" name="actual" required>

    <label>Select Output:</label>
    <select name="output" required>
      <option value="">-- Choose Output --</option>
      {% for output in outputs %}
        <option value="{{ output.id }}">{{ output.title }}</option>
      {% endfor %}
    </select>

    <button type="submit">Add Indicator</button>
  </form>
  </div>

  <!-- Indicator Table -->
   <div class="indicator-table">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Means of Verification</th>
        <th>Unit</th>
        <th>Baseline</th>
        <th>Target</th>
        <th>Actual</th>
        <th>Progress (%)</th>
        <th>Output</th>
      </tr>
    </thead>
    <tbody>
      {% for indicator in indicators %}
        <tr>
          <td>{{ indicator.name }}</td>
          <td>{{ indicator.means_of_verification }}</td>
          <td>{{ indicator.unit_of_measurement }}</td>
          <td>{{ indicator.baseline }}</td>
          <td>{{ indicator.target }}</td>
          <td>{{ indicator.actual }}</td>
          <td>{{ indicator.progress }}</td>
          <td>{{ indicator.output.title }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>

  <hr>


</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("indicator-form");
  form.addEventListener("submit", function (event) {
    event.preventDefault();
    const formData = new FormData(form);

    fetch("/api/v1/logframe/api/indicators/", {
      method: "POST",
      body: formData,
      headers: {
        'X-CSRFToken': '{{ csrf_token }}'
      }
    })
      .then(response => {
        if (response.ok) {
          location.reload();
        } else {
          return response.json().then(data => {
            alert("Error: " + JSON.stringify(data));
          });
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Failed to add indicator.");
      });
  });
});
</script>
{% endblock %}
